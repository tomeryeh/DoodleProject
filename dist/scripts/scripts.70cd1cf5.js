"use strict";var app=angular.module("doodleApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.sortable","LocalStorageModule","ui.bootstrap","firebase"]).config(["localStorageServiceProvider",function(a){a.setPrefix("ls")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/logout.html",controller:"FormCtrl"}).when("/about",{templateUrl:"views/about.html"}).when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/step1",{templateUrl:"views/step1.html",controller:"FormCtrl"}).when("/step2",{templateUrl:"views/step2.html",controller:"FormCtrl"}).when("/step3",{templateUrl:"views/step3.html",controller:"FormCtrl"}).when("/summary",{templateUrl:"views/summary.html",controller:"FormCtrl"}).when("/result",{templateUrl:"views/result.html",controller:"FormCtrl"}).when("/chooseDates",{templateUrl:"views/chooseDates.html",controller:"ChooseDatesCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]);app.factory("Auth",["$firebaseAuth",function(a){return a()}]),app.service("meetingsCounter",function(){var a=0,b=function(b){a=b},c=function(b){return a};return{setCounter:b,getCounter:c}}),app.service("meetingIndex",function(){var a=0,b=function(b){a=b},c=function(b){return a};return{setIndex:b,getIndex:c}}),app.factory("loginUser",function(){return{}}),angular.module("doodleApp").controller("FormCtrl",["$scope","localStorageService","$firebaseObject","Auth","$location","$filter","meetingsCounter",function(a,b,c,d,e,f,g){a.datepickerOptions={initDate:new Date,minDate:new Date,showWeeks:!1},a.init=function(){a.meeting=b.get("meeting"),a.meetings=b.get("meetings"),a.$watch("meeting",function(){b.set("meeting",a.meeting)},!0)},a.removeMeeting=function(){var f=d.$getAuth();a.meetings.splice(a.meeting.id,1);var g=firebase.database().ref("meetings/"+f.uid),h=c(g);h.data=a.meetings,h.$save(),b.set("meeting",null),b.set("meetings",a.meetings),e.path("/step1")},a.saveMeeting=function(){var f=d.$getAuth(),g=firebase.database().ref("meetings/"+f.uid),h=c(g);a.meeting.id?a.meetings[a.meeting.id]=a.meeting:(a.meeting.id=a.meetings.length,a.meetings[a.meetings.length]=a.meeting),h.data=a.meetings,h.$save(),b.set("meetings",a.meetings);var i=firebase.database().ref(),j=c(i.child("meetings").child("counter"));j.$loaded().then(function(){j.$value=j.$value+1,j.$save()});var k=e.absUrl().split("/");k[k.length-1]="chooseDates",a.url=k.join("/")+"?user="+f.uid+"&event="+a.meeting.id,a.sendEmail()},a.addParticipant=function(){var b={name:a.paticipantName,email:a.paticipantEmail,vip:a.paticipantVip,pick:!1};a.meeting.participants=a.meeting.participants||[],a.meeting.participants.push(b),a.paticipantName="",a.paticipantEmail=""},a.removeParticipant=function(b){a.meeting.participants.splice(b,1)},a.addDate=function(){var b=f("date")(a.startTime,"HH:mm"),c={dateCh:a.datepicker.toLocaleDateString(),hourCh:b,howLongCh:a.howLong,names:[],isMark:!1};a.meeting.dates=a.meeting.dates||[],a.meeting.dates.push(c)},a.removeDate=function(b){a.meeting.dates.splice(b,1)},a.updateData=function(){var e=d.$getAuth(),f=firebase.database().ref(),g=c(f.child("meetings").child(e.uid).child("data"));g.$loaded().then(function(){g&&(b.set("meeting",g[a.meeting.id]),a.meeting=b.get("meeting"),a.calcResult())})},a.calcResult=function(){var b=[];a.totalPart=a.meeting.participants.length,a.partPick=0;for(var c=a.meeting.participants.length-1;c>=0;c--){if(1==a.meeting.participants[c].vip){var d=a.meeting.participants[c].email;b.push(d)}1==a.meeting.participants[c].pick&&a.partPick++}for(var c=a.meeting.dates.length-1;c>=0;c--)if(a.meeting.dates[c].allVips=0,a.meeting.dates[c].vipCounter=0,a.meeting.dates[c].partCounter=a.meeting.dates[c].names?a.meeting.dates[c].names.length:0,a.meeting.dates[c].passMinPart=a.meeting.dates[c].partCounter>=a.meeting.minPart?1:0,a.meeting.dates[c].vipNames=[],a.meeting.dates[c].names){for(var e=a.meeting.dates[c].names.length-1;e>=0;e--){var f=a.meeting.dates[c].names[e];-1!=b.indexOf(f)&&(a.meeting.dates[c].vipCounter++,a.meeting.dates[c].vipNames.push(f))}a.meeting.dates[c].vipCounter==b.length&&(a.meeting.dates[c].allVips=1)}a.afterCalc=!0},a.enableSend=function(){$("#sendResultsBtn").removeAttr("disabled")},a.sendResultEmail=function(){for(var b=$("input:radio[name=pickDate]:checked").val(),c=a.meeting.participants.length-1;c>=0;c--)emailjs.send("gmail","result",{to_name:a.meeting.participants[c].name,to_email:a.meeting.participants[c].email,from_name:a.meeting.name,message_html:b})},a.sendEmail=function(){for(var b=a.meeting.participants.length-1;b>=0;b--)emailjs.send("gmail","template_ybWM6OV9",{to_name:a.meeting.participants[b].name,url:a.url,to_email:a.meeting.participants[b].email,from_name:a.meeting.name,event:a.meeting.topic,message_html:a.meeting.description})},a.init()}]),angular.module("doodleApp").controller("HeaderController",["$scope","$location","Auth","loginUser","localStorageService","$firebaseObject","meetingsCounter","$firebaseArray",function(a,b,c,d,e,f,g,h){a.auth=c,a.init=function(){var b=firebase.database().ref(),c=f(b.child("meetings").child("counter"));c.$loaded().then(function(){g.setCounter(c.$value),a.eventCounter=c.$value})},a.isActive=function(a){return a===b.path()},a.signIn=function(){a.auth=c,a.firebaseUser=null,a.error=null,a.auth.$signInWithPopup("google").then(function(a){a.credential.idToken,a.user;b.path("/step1")})["catch"](function(a){a.code,a.message,a.email,a.credential})},a.signOut=function(){a.auth=c,a.auth.$signOut()},a.auth.$onAuthStateChanged(function(c){if(a.firebaseUser=c,c){console.log("Signed in as:",c.uid);var d=firebase.database().ref(),f=h(d.child("meetings").child(c.uid).child("data"));f.$loaded().then(function(){e.set("meetings",f),b.path("/home")})}else"/chooseDates"!=b.path()&&b.path("/"),e.remove("meeting"),e.remove("meetings"),console.log("Signed out")}),a.init()}]),app.controller("ChooseDatesCtrl",["$scope","$firebaseObject","$location","$firebaseArray",function(a,b,c,d){a.init=function(){a.afterSave=!1;var b=c.search();a.eventId=b.event,a.userId=b.user;var e=firebase.database().ref();a.DBData=d(e.child("meetings").child(a.userId).child("data")),a.DBData.$loaded().then(function(){a.dates=a.DBData[a.eventId].dates})},a.savePick=function(){var b=firebase.database().ref();a.DBData=d(b.child("meetings").child(a.userId).child("data")),a.DBData.$loaded().then(function(){a.upDatedDates=a.DBData[a.eventId].dates;for(var b=a.chooseDateEmail,c=a.dates.length-1;c>=0;c--)a.dates[c].isMark?(a.upDatedDates[c].names=a.dates[c].names||[],a.upDatedDates[c].isMark=!1,a.upDatedDates[c].names.push(b)):a.upDatedDates[c].names=a.dates[c].names||[];for(var c=a.DBData[a.eventId].participants.length-1;c>=0;c--)a.DBData[a.eventId].participants[c].email==b&&(a.DBData[a.eventId].participants[c].pick=!0);a.DBData[a.eventId].dates=a.upDatedDates,a.DBData.$save()}),a.afterSave=!0},a.init()}]),angular.module("doodleApp").controller("HomeCtrl",["$scope","localStorageService","$firebaseObject","Auth","$location","$filter","meetingsCounter",function(a,b,c,d,e,f,g){a.init=function(){a.meetings=b.get("meetings")},a.newMeeting=function(){b.set("meeting",null),e.path("/step1")},a.loadMeeting=function(c){a.curMeeting=a.meetings[c],a.curMeeting.id=c,b.set("meeting",a.curMeeting),e.path("/result")},a.init()}]),angular.module("doodleApp").run(["$templateCache",function(a){a.put("views/about.html",'<div class="container"> <div class="row text-center"> <h2>Who are we ?</h2> </div> <div class="row"> <h4> We are 4 3rd year students of Industrial Engineering and Management, study at the “Azrieli Academic Collage Of Engineering ” in Jerusalem, Israel. </h4> <h4>So why did we established the website?</h4> <h4> Everyone probably experienced difficulties to organize a meeting with friends or colleagues. The reason is that each of you have a lot of constraints- work, family, kids, studies etc. So this website can help you to find the ideal day for all of you without dealing all the constraints and spending unnecessary time. Each of you just need to choose his optional days, and we will take care of the rest. We hope you enjoy our website, and have a nice meeting. </h4> <h4>Snir, Reuven, Aviram and Ortl :)</h4> </div> <br> </div>'),a.put("views/chooseDates.html",'<div class="container"> <div ng-hide="afterSave"> <form role="form" name="chooseForm"> <div class="form-group"> <label for="email" class="control-label">Please enter your email address</label> <input type="email" ng-model="chooseDateEmail" class="form-control" id="email" name="email" placeholder="letsmeet@gmail.com" required> <div ng-show="chooseForm.email.$dirty"> <span ng-show="chooseForm.email.$error.required" class="alert-danger">Please enter something</span> <span ng-show="chooseForm.email.$error.email" class="alert-danger">Please enter valid email</span> </div> </div> </form> <h3>Choose the dates you can attend</h3> <table class="table"> <thead> <tr> <th>Date</th> <th>Hour</th> <th>How long in hours</th> <th>Can you attend ?</th> </tr> </thead> <tbody> <tr ng-repeat="date in dates" ng-class="{success: event.done}"> <td>{{date.dateCh}}</td> <td>{{date.hourCh}}</td> <td>{{date.howLongCh}}</td> <td><input type="checkbox" ng-model="date.isMark" name=""></td> </tr> </tbody> </table> <p><button ng-disabled="chooseForm.$invalid" type="button" ng-click="savePick()" class="btn btn-info">Submit</button></p> </div> <div ng-show="afterSave"> <p> <h3><span class="label label-success">Thank you for choosing the date. The event owner will update you on the final date.</span></h3> </p> <br> <br> <br> </div> </div>'),a.put("views/home.html",'<div class="container"> <div class="row"> <div class="col-sm-8"> <h2>Let’sMeet simplifies scheduling</h2> <br> <h4>Find the ideal date for a meeting, quickly and efficiently</h4> </div> <div class="col-sm-4"> <p><a ng-click="newMeeting()" class="btn btn-info" role="button">Create new meeting</a></p> <div class="panel panel-default"> <div class="panel-heading">Choose from active meetings</div> <div class="panel-body"> <ul ng-model="meetings" class="list-group"> <li class="list-group-item" ng-repeat="meeting in meetings" style="cursor:move"> <a ng-click="loadMeeting($index)" href="">Load - {{meeting.topic}}</a> <!-- <a ng-click="removeDate($index)" href="" class="badge" style="color:white"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a> --> </li> </ul> </div> </div> </div> </div> <div class="row"> <img class="img-responsive" src="images/meeting.125ec88e.jpg"> </div> <br> </div>'),a.put("views/login.html",'<div> <button ng-click="signIn()">Sign In With Google</button> <p ng-if="firebaseUser">Signed in user: <strong>{{ firebaseUser.uid }}</strong></p> <p ng-if="error">Error: <strong>{{ error }}</strong></p> </div>'),a.put("views/logout.html",'<div class="container"> <h2>Let’sMeet simplifies scheduling</h2> <br> <h4>Find the ideal date for a meeting, quickly and efficiently</h4> <br> </div>'),a.put("views/result.html",'<div class="container"> <h2>Let\'s Meet Results</h2> <p>Here you can see the best date for your meeting. Green rows are a prefect match for the date (all vips + pass min paricipants). </p> <p> <button class="btn btn-success" ng-click="updateData()">Calculate results</button> <button class="btn btn-danger" ng-click="removeMeeting()">Delete meeting</button> </p> <div ng-show="afterCalc"> <p> {{partPick}} of your {{totalPart}} participants choosed a date. </p> <table class="table"> <thead> <tr> <th>Final Pick</th> <th>Date</th> <th>Passed min paritipants</th> <th>All vips</th> <th>Num of Vips</th> <th>Total paritcipants</th> </tr> </thead> <tbody ng-repeat="resDate in meeting.dates  | orderBy:[\'passMinPart\',\'allVips\',\'vipCounter\',\'partCounter\']:true"> <tr ng-class="{\'success\': resDate.passMinPart && resDate.allVips }" class="clickable" data-toggle="collapse" id="{{$index}}" data-target=".{{$index}}collapsed" style="cursor:pointer"> <td><input ng-click="enableSend()" type="radio" name="pickDate" value="{{resDate.dateCh}} - {{resDate.hourCh}}"></td> <td>{{resDate.dateCh}} - {{resDate.hourCh}}</td> <td> <span ng-show="resDate.passMinPart == 1" class="glyphicon glyphicon-ok"></span> <span ng-show="resDate.passMinPart == 0" class="glyphicon glyphicon-remove"></span> </td> <td> <span ng-show="resDate.allVips == 1" class="glyphicon glyphicon-ok"></span> <span ng-show="resDate.allVips == 0" class="glyphicon glyphicon-remove"> </td> <td>{{resDate.vipCounter}}</td> <td>{{resDate.partCounter}}</td> </tr> <tr class="collapse out budgets {{$index}}collapsed"> <td></td> <td></td> <td></td> <td> <div ng-repeat="v in resDate.vipNames track by $index"> <span>{{v}}</span><br> </div> </td> <td> <div ng-repeat="n in resDate.names track by $index"> <span>{{n}}</span><br> </div> </td> </tr> </tbody> </table> <p>After selecting the best date you can send the result to all participants</p> <p><button id="sendResultsBtn" class="btn btn-success" ng-click="sendResultEmail()" disabled>Send results</button></p> </div> </div>'),a.put("views/step1.html",'<div class="container"> <h2>Let\'s schedule a new meeting </h2> <hr> <form role="form"> <div class="form-group"> <label for="topic" class="control-label">Topic</label> <input type="text" ng-model="meeting.topic" class="form-control" id="topic" placeholder="Set the meeting target"> <!--<span class="" ng-show="meeting.topic.$touched && meeting.topic.$invalid">Required field</span>--> </div> <div class="form-group"> <label for="location" class="control-label">Where (optional)</label> <input type="text" ng-model="meeting.where" class="form-control" id="location" placeholder="Set the location"> </div> <div class="form-group"> <label for="description" class="control-label">Description (optional)</label> <input type="text" ng-model="meeting.description" class="form-control" id="description" placeholder="Tell the participants about the meeting"> </div> <div class="form-group"> <label for="name" class="control-label">Your Name</label> <input type="text" ng-model="meeting.name" class="form-control" id="name" placeholder="Your name"> </div> <div class="form-group"> <label for="email" class="control-label">E-mail address</label> <input type="text" ng-model="meeting.email" class="form-control" id="email" placeholder="letsmeet@gmail.com"> </div> <!--<input type="button" ng-click="sendEmail()" value="Send Email" name="">--> <p><a href="#/step2" class="btn btn-info" role="button">Next Step</a></p> </form> </div>'),a.put("views/step2.html",'<div class="container"> <h2>Choose dates </h2> <hr> <div class="row"> <div class="col-sm-6"> <form class="form"> <div class="form-group"> <label for="date" class="control-label">Date</label> <pre>Selected date is: <em>{{datepicker | date:\'fullDate\' }}</em></pre> <div class="well well-sm"> <uib-datepicker id="date" ng-model="datepicker" datepicker-options="datepickerOptions"></uib-datepicker> </div> </div> <div class="form-group"> <label for="beginHour" class="control-label">Metting start at </label> <div class="well well-sm"> <uib-timepicker id="beginHour" ng-model="startTime" ng-change="changed()"></uib-timepicker> </div> </div> <div class="form-group"> <label class="sr-only" for="exampleInputAmount">Amount (in dollars)</label> <div class="input-group"> <div class="input-group-addon">For</div> <input type="number" name="" ng-model="howLong" class="form-control"> <div class="input-group-addon">hours</div> </div> </div> <div class="form-group"> <input type="button" class="btn btn-primary" ng-click="addDate()" value="Add to date list" name=""> </div> <p><a href="#/step3" class="btn btn-info" role="button">Next Step</a></p> </form> </div> <div class="col-sm-6"> <div class="panel panel-default"> <div class="panel-heading">Dates</div> <div class="panel-body"> <ul ui-sortable ng-model="meeting.dates" class="list-group"> <li class="list-group-item" ng-repeat="dateItem in meeting.dates" style="cursor:move"> {{dateItem.dateCh}} - {{dateItem.hourCh}} - for {{dateItem.howLongCh}} hours <a ng-click="removeDate($index)" href="" class="badge" style="color:white"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a> </li> </ul> </div> </div> </div> </div></div>'),a.put("views/step3.html",'<div class="container"> <h2>Select paricipants </h2> <hr> <form role="form" ng-submit="addParticipant()"> <div class="form-group"> <label for="minPart" class="control-label">Minimum Participnats</label> <input type="number" id="minPart" class="form-control" ng-model="meeting.minPart" name=""> </div> <div class="form-group"> <label for="partName" class="control-label">Name</label> <input type="text" id="partName" placeholder="Name" ng-model="paticipantName" class="form-control"> </div> <div class="form-group"> <label for="partEmail" class="control-label">Email</label> <input type="text" id="partEmail" placeholder="letsmeet@gmail.com" ng-model="paticipantEmail" class="form-control"> </div> <div class="form-group"> <label for="partId" class="control-label">Is Vip ?</label> <input type="checkbox" id="partId" ng-model="paticipantVip" class="form-control"> </div> <span class="input-group-btn"> <input type="submit" class="btn btn-primary" value="Add"> </span> </form> <div ui-sortable ng-model="meeting.participants"> <p class="input-group" ng-repeat="participantItem in meeting.participants" style="padding:5px 10px;cursor:move"> <input class="form-control" value="{{ participantItem.name }} - {{ participantItem.email }} {{ participantItem.vip ? \'- Vip\' : \'\' }}" disabled> <span class="input-group-btn"> <button class="btn btn-danger" ng-click="removeParticipant($index)" aria-label="Remove">X</button> </span> </p> </div> <p><a href="#/summary" class="btn btn-info" role="button">Finish</a></p> </div>'),a.put("views/summary.html",'<div class="container"> <h2>Meeting Summary</h2> <hr> <p><label>Event topic : {{ meeting.topic }}</label></p> <p><label>Minimum participant : {{ meeting.minPart }}</label></p> <p><label>Invited participants : </label> <ul> <li ng-repeat="part in meeting.participants">{{ part.name }}</li> </ul> </p> <p> <label>Dates : </label> <ul> <li ng-repeat="date in meeting.dates">{{date.dateCh}} / {{date.hourCh}} / {{date.howLongCh}}</li> </ul> </p> <p><button type="button" class="btn btn-success" ng-click="saveMeeting()">Save Meeting</button></p> <div ng-show="url" class="row"> <p>We created a link for your paticipant to choose their dates.</p> <p>The url was sent in mail to each participant.</p> <p>You can also send the url to them by yourself :</p> </div> <div ng-show="url" class="row"><p>{{ url }}</p></div> </div>')}]);