"use strict";var app=angular.module("doodleApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.sortable","LocalStorageModule","ui.bootstrap","firebase"]).config(["localStorageServiceProvider",function(a){a.setPrefix("ls")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/logout.html",controller:"FormCtrl"}).when("/step1",{templateUrl:"views/step1.html",controller:"FormCtrl"}).when("/step2",{templateUrl:"views/step2.html",controller:"FormCtrl"}).when("/step3",{templateUrl:"views/step3.html",controller:"FormCtrl"}).when("/summary",{templateUrl:"views/summary.html",controller:"FormCtrl"}).when("/result",{templateUrl:"views/result.html",controller:"FormCtrl"}).when("/chooseDates",{templateUrl:"views/chooseDates.html",controller:"ChooseDatesCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]);app.factory("Auth",["$firebaseAuth",function(a){return a()}]),app.factory("wizardData",function(){return{}}),app.factory("loginUser",function(){return{}}),angular.module("doodleApp").controller("FormCtrl",["$scope","localStorageService","$firebaseObject","Auth","$location","$filter",function(a,b,c,d,e,f){a.datepickerOptions={initDate:new Date,minDate:new Date,showWeeks:!1},a.init=function(){a.meeting=b.get("meeting"),a.$watch("meeting",function(){b.set("meeting",a.meeting)},!0)},a.saveMeeting=function(){var b=d.$getAuth(),f=firebase.database().ref("meetings/"+b.uid),g=c(f);g.data=a.meeting,g.$save();var h=e.absUrl().split("/");h[h.length-1]="chooseDates",a.url=h.join("/")+"?event="+b.uid},a.addParticipant=function(){var b={name:a.paticipantName,email:a.paticipantEmail,vip:a.paticipantVip};a.meeting.participants=a.meeting.participants||[],a.meeting.participants.push(b),a.paticipantName="",a.paticipantEmail=""},a.removeParticipant=function(b){a.meeting.participants.splice(b,1)},a.addDate=function(){var b=f("date")(a.startTime,"HH:mm"),c={dateCh:a.datepicker.toLocaleDateString(),hourCh:b,howLongCh:a.howLong,names:[],isMark:!1};a.meeting.dates=a.meeting.dates||[],a.meeting.dates.push(c)},a.removeDate=function(b){a.meeting.dates.splice(b,1)},a.calcResult=function(){for(var b=[],c=a.meeting.participants.length-1;c>=0;c--)if(1==a.meeting.participants[c].vip){var d=a.meeting.participants[c].email;b.push(d)}for(var c=a.meeting.dates.length-1;c>=0;c--)if(a.meeting.dates[c].allVips=0,a.meeting.dates[c].vipCounter=0,a.meeting.dates[c].partCounter=a.meeting.dates[c].names?a.meeting.dates[c].names.length:0,a.meeting.dates[c].passMinPart=a.meeting.dates[c].partCounter>=a.meeting.minPart?1:0,a.meeting.dates[c].names){for(var e=a.meeting.dates[c].names.length-1;e>=0;e--){var f=a.meeting.dates[c].names[e];-1!=b.indexOf(f)&&a.meeting.dates[c].vipCounter++}a.meeting.dates[c].vipCounter==b.length&&(a.meeting.dates[c].allVips=1)}a.afterCalc=!0},a.sendEmail=function(){emailjs.send("gmail","template_ybWM6OV9",{to_name:"James",notes:"Check this out!",to_email:"tomer.yeh@gmail.com",from_name:"hadar"})},a.init()}]),angular.module("doodleApp").controller("HeaderController",["$scope","$location","Auth","loginUser","localStorageService","$firebaseObject",function(a,b,c,d,e,f){a.auth=c,a.isActive=function(a){return a===b.path()},a.signIn=function(){a.auth=c,a.firebaseUser=null,a.error=null,a.auth.$signInWithPopup("google").then(function(a){a.credential.idToken,a.user;b.path("/step1")})["catch"](function(a){a.code,a.message,a.email,a.credential})},a.signOut=function(){a.auth=c,a.auth.$signOut()},a.auth.$onAuthStateChanged(function(c){if(a.firebaseUser=c,c){console.log("Signed in as:",c.uid);var d=firebase.database().ref(),g=f(d.child("meetings").child(c.uid).child("data"));g.$loaded().then(function(){null!=g.topic&&(e.set("meeting",g),b.path("/result"))})}else"/chooseDates"!=b.path()&&b.path("/"),e.remove("meeting"),console.log("Signed out")})}]),app.controller("ChooseDatesCtrl",["$scope","$firebaseObject","$location",function(a,b,c){a.init=function(){a.afterSave=!1;var d=c.search(),e=d.event,f=firebase.database().ref();a.DBData=b(f.child("meetings").child(e).child("data")),a.DBData.$loaded().then(function(){a.dates=a.DBData.dates})},a.savePick=function(){for(var b=a.chooseDateEmail,c=a.dates.length-1;c>=0;c--)a.dates[c].isMark?(a.dates[c].names=a.dates[c].names||[],a.dates[c].isMark=!1,a.dates[c].names.push(b)):a.dates[c].names=a.dates[c].names||[];a.DBData.dates=a.dates,a.DBData.$save(),a.afterSave=!0},a.init()}]),angular.module("doodleApp").run(["$templateCache",function(a){a.put("views/chooseDates.html",'<div class="container"> <form role="form"> <div class="form-group"> <label for="email" class="control-label">Please enter your email address</label> <input type="text" ng-model="chooseDateEmail" class="form-control" id="email" placeholder="letsmeet@gmail.com"> </div> </form> <h3>Choose the dates you can attend</h3> <table class="table"> <thead> <tr> <th>Date</th> <th>Hour</th> <th>How long in hours</th> <th>Can you attend ?</th> </tr> </thead> <tbody> <tr ng-repeat="date in dates" ng-class="{success: event.done}"> <td>{{date.dateCh}}</td> <td>{{date.hourCh}}</td> <td>{{date.howLongCh}}</td> <td><input type="checkbox" ng-model="date.isMark" name=""></td> </tr> </tbody> </table> <p><button type="button" ng-click="savePick()" class="btn btn-info">Submit</button></p> <p> <h3><span class="label label-success" ng-show="afterSave">Thank you for choosing the date. The event owner will update you on the final date.</span></h3> </p> </div>'),a.put("views/login.html",'<div> <button ng-click="signIn()">Sign In With Google</button> <p ng-if="firebaseUser">Signed in user: <strong>{{ firebaseUser.uid }}</strong></p> <p ng-if="error">Error: <strong>{{ error }}</strong></p> </div>'),a.put("views/logout.html",'<div class="container"> <br> <p>The app will help you schcudle !</p> <br> </div>'),a.put("views/result.html",'<div class="container"> <h2>Let\'s Meet Results</h2> <p>Here you can see the best date for your meeting. Green rows are a prefect match for the date (all vips + pass min paricipants). </p> <p><button class="btn btn-success" ng-click="calcResult()">Calculate results</button></p> <table class="table" ng-show="afterCalc"> <thead> <tr> <th>Date</th> <th>Passed min paritipants</th> <th>All vips</th> <th>Num of Vips</th> <th>Total paritcipants</th> </tr> </thead> <tbody> <tr ng-repeat="resDate in meeting.dates | orderBy:[\'passMinPart\',\'allVips\',\'vipCounter\',\'partCounter\']:true" ng-class="{\'success\': resDate.passMinPart && resDate.allVips }"> <td>{{resDate.dateCh}}</td> <td> <span ng-show="resDate.passMinPart == 1" class="glyphicon glyphicon-ok"></span> <span ng-show="resDate.passMinPart == 0" class="glyphicon glyphicon-remove"></span> </td> <td> <span ng-show="resDate.allVips == 1" class="glyphicon glyphicon-ok"></span> <span ng-show="resDate.allVips == 0" class="glyphicon glyphicon-remove"> </td> <td>{{resDate.vipCounter}}</td> <td>{{resDate.partCounter}}</td> </tr> </tbody> </table> <table> <!-- <div ng-repeat="resDate in meeting.dates | orderBy:[\'passMinPart\',\'allVips\',\'vipCounter\',\'partCounter\']">{{resDate.dateCh}}-{{resDate.passMinPart}}-{{resDate.allVips}}-{{resDate.vipCounter}}-{{resDate.partCounter}}</div> --> </table></div>'),a.put("views/step1.html",'<div class="container"> <h2>Let\'s schedule a new meeting </h2> <hr> <form role="form"> <div class="form-group"> <label for="topic" class="control-label">Topic</label> <input type="text" ng-model="meeting.topic" class="form-control" id="topic" placeholder="Set the meeting target"> <!--<span class="" ng-show="meeting.topic.$touched && meeting.topic.$invalid">Required field</span>--> </div> <div class="form-group"> <label for="location" class="control-label">Where (optional)</label> <input type="text" ng-model="meeting.where" class="form-control" id="location" placeholder="Set the location"> </div> <div class="form-group"> <label for="description" class="control-label">Description (optional)</label> <input type="text" ng-model="meeting.description" class="form-control" id="description" placeholder="Tell the participants about the meeting"> </div> <div class="form-group"> <label for="name" class="control-label">Your Name</label> <input type="text" ng-model="meeting.name" class="form-control" id="name" placeholder="Your name"> </div> <div class="form-group"> <label for="email" class="control-label">E-mail address</label> <input type="text" ng-model="meeting.email" class="form-control" id="email" placeholder="letsmeet@gmail.com"> </div> <!--<input type="button" ng-click="sendEmail()" value="Send Email" name="">--> <p><a href="#/step2" class="btn btn-info" role="button">Next Step</a></p> </form> </div>'),a.put("views/step2.html",'<div class="container"> <h2>Choose dates </h2> <hr> <div class="row"> <div class="col-sm-6"> <form class="form"> <div class="form-group"> <label for="date" class="control-label">Date</label> <pre>Selected date is: <em>{{datepicker | date:\'fullDate\' }}</em></pre> <div style="display:inline-block; min-height:290px"> <uib-datepicker id="date" ng-model="datepicker" class="well well-sm" datepicker-options="datepickerOptions"></uib-datepicker> </div> </div> <div class="form-group"> <label for="beginHour" class="control-label">Metting start at </label> <uib-timepicker id="beginHour" ng-model="startTime" ng-change="changed()"></uib-timepicker> <label class="contorl-label"> For </label> <input type="number" name="" ng-model="howLong"> <label class="contorl-label"> hours </label> </div> <div class="form-group"> <input type="button" class="btn btn-primary" ng-click="addDate()" value="Add to date list" name=""> </div> <p><a href="#/step3" class="btn btn-info" role="button">Next Step</a></p> </form> </div> <div class="col-sm-6"> <label class="control-label">Date List</label> <div ui-sortable ng-model="meeting.dates"> <p class="input-group" ng-repeat="dateItem in meeting.dates" style="padding:5px 10px;cursor:move"> <input class="form-control" value="{{dateItem.dateCh}} - {{dateItem.hourCh}} - for {{dateItem.howLongCh}} hours" type="text"> <span class="input-group-btn"> <button class="btn btn-danger" ng-click="removeDate($index)" aria-label="Remove">X</button> </span> </p> </div> </div> </div> </div>'),a.put("views/step3.html",'<div class="container"> <h2>Select paricipants </h2> <hr> <form role="form" ng-submit="addParticipant()"> <div class="form-group"> <label for="minPart" class="control-label">Minimum Participnats</label> <input type="number" id="minPart" class="form-control" ng-model="meeting.minPart" name=""> </div> <div class="form-group"> <label for="partName" class="control-label">Name</label> <input type="text" id="partName" placeholder="Name" ng-model="paticipantName" class="form-control"> </div> <div class="form-group"> <label for="partEmail" class="control-label">Email</label> <input type="text" id="partEmail" placeholder="letsmeet@gmail.com" ng-model="paticipantEmail" class="form-control"> </div> <div class="form-group"> <label for="partId" class="control-label">Is Vip ?</label> <input type="checkbox" id="partId" ng-model="paticipantVip" class="form-control"> </div> <span class="input-group-btn"> <input type="submit" class="btn btn-primary" value="Add"> </span> </form> <div ui-sortable ng-model="meeting.participants"> <p class="input-group" ng-repeat="participantItem in meeting.participants" style="padding:5px 10px;cursor:move"> <input class="form-control" value="{{ participantItem.name }} - {{ participantItem.email }} {{ participantItem.vip ? \'- Vip\' : \'\' }}" disabled> <span class="input-group-btn"> <button class="btn btn-danger" ng-click="removeParticipant($index)" aria-label="Remove">X</button> </span> </p> </div> <p><a href="#/summary" class="btn btn-info" role="button">Finish</a></p> </div>'),a.put("views/summary.html",'<div class="container"> <h2>Meeting Summary</h2> <hr> <p><label>Event topic : {{ meeting.topic }}</label></p> <p><label>Minimum participant : {{ meeting.minPart }}</label></p> <p><label>Invited participants : </label> <ul> <li ng-repeat="part in meeting.participants">{{ part.name }}</li> </ul> </p> <p> <label>Dates : </label> <ul> <li ng-repeat="date in meeting.dates">{{date.dateCh}} / {{date.hourCh}} / {{date.howLongCh}}</li> </ul> </p> <p><button type="button" class="btn btn-success" ng-click="saveMeeting()">Save meeting and get URL</button></p> <div ng-show="url" class="row"><p>Send this url to your paticipants for selecting the time :</p></div> <div ng-show="url" class="row"><p>{{ url }}</p></div> </div>')}]);